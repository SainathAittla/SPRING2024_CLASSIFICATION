---
title: "Case Study on A Marketing Dataset"
author: "EAS 508"
date: "`r Sys.Date()`"
output:
  slidy_presentation: default
  ioslides_presentation: default
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

# Direct Marketing Dataset

-   A direct marketing firm has a data set containing information on
    past customer behavior (actually the amount spent on buying
    products)

-   This is a simulated data which mimics data from a direct marketing
    company

-   We are interested in knowing which customer characteristics can
    predict AmountSpent (amount spent on buying products)

-   To answer questions like this we introduce indicator variable and
    interaction terms and their interpretation

# Load the Dataset

Read the file "direct_marketing.csv" into a dataframe called dirmkt

```{r}
library(readr)
dirmkt <- read_csv("direct_marketing.csv")
```

# Load the Dataset

Convert categorical variables to factors with specified levels

```{r}
dirmkt$Age <- factor(dirmkt$Age, levels = c("Old", "Middle", "Young"))
dirmkt$Gender <- factor(dirmkt$Gender, levels = c("Female", "Male"))
dirmkt$OwnHome <- factor(dirmkt$OwnHome, levels = c("Own", "Rent"))
dirmkt$Married <- factor(dirmkt$Married, levels = c("Single", "Married"))
dirmkt$Location <- factor(dirmkt$Location, levels = c("Far", "Close"))
dirmkt$History <- factor(dirmkt$History, levels = c("High", "Low", "Medium", "None"))


```

```{r}
head(dirmkt)
```

# Why Do We Have to Convert Categorical Data to Factors

-   For many purposes within R, the most convenient way to handle
    categorical variables is to convert them to factor variables.

-   Factor in R is also known as a categorical variable that stores both
    string and integer data values as levels.

-   Factor is mostly used in Statistical Modeling and exploratory data
    analysis with R.

### Syntax

`factor(x = character(), levels, labels = levels, ordered = is.ordered(x))`

-   x: A vector of categorical data in R. Need to be a string or
    integer, not decimal.
-   Levels: A vector of possible values taken by x. This argument is
    optional. The default value is the unique list of items of the
    vector x.
-   Labels: Add a label to the x categorical data in R. For example, 1
    can take the label `male` while 0, the label `female`.
-   ordered: Determine if the levels should be ordered in categorical
    data in R.

# Creating a Factor Data Frame

-   Create gender vector

```{r}
gender_vector <- c("Male", "Female", "Female", "Male", "Male")
class(gender_vector)
```

-   Convert gender_vector to a factor

```{r}
factor_gender_vector <-factor(gender_vector)
class(factor_gender_vector)
```

# Example

**It is important to transform a string into factor variable in R when
we perform Machine Learning task.**

Create a color vector

```{r}
color_vector <- c('blue', 'red', 'green', 'white', 'black', 'yellow')
```

Convert the vector to factor

```{r}
factor_color <- factor(color_vector)

factor_color
```

# Exploring the dirmkt Dataframe

-   We would like to understand better the reasons why some individuals
    spend more than others

-   In particular, we would like to investigate whether salary has an
    influence on AmountSpent

-   we start with

`AmountSpent, Salary`

```{r}
library(ggplot2)

ggplot(dirmkt, aes(x= Salary, y=AmountSpent)) + geom_point() +
  scale_colour_hue(l=50) + # Use a slightly darker palette than normal
  geom_smooth(method='auto',   # Add linear regression lines
              se=FALSE,    # Don't add shaded confidence region
              fullrange=TRUE) # Extend regression lines

```

# What to do about the Categorical Variable?

```{r}
data.frame(dirmkt[1:10,c('Age','Salary','AmountSpent')])
```

-   Is this categorical variable important?

-   Does being Middle-aged or Old potentially have an effect on
    AmountSpent compared to being Young?

-   How can we include the Age variable in a regression model that
    requires numeric values?

# Prepare Qualitative Predictor Variable for Regression

-   Consider the variable Age

-   We want to investigate the effect of Age on AmountSpent. Note that
    Age is a qualitative (or categorical) variable with three possible
    values: Young, Middle, or Old

-   We need to quantify this variable

# Creating Dummy Variables

-   Since we have three possible values for Age, we need to create two
    indicator (or dummy) variables

-   The base (or reference) case, with both dummy variables set to 0, is
    Age = Young. This is the reference group to compare for the other
    values of the dummy variable. It is up to the modeler to determine
    which value of the categorical variable is used as the base case

-   The two dummy variables that we have created are:

$$ AgeMid =
\begin{cases}
  1, & \text{if Age=Middle } \\
  0, & \text{ohterwise}
\end{cases},
\qquad AgeOld =
\begin{cases}
  1, & \text{if Age=Old } \\
  0, & \text{ohterwise}
\end{cases}
$$

# Assigning Values (0 or 1) to the New Dummy Variables

```{r}
dirmkt$AgeMid <- ifelse(dirmkt$Age == "Middle", 1, 0)
dirmkt$AgeOld <- ifelse(dirmkt$Age == "Old", 1, 0)

head(dirmkt[,c('Age','AgeMid','AgeOld')])
```

We then run the regression,

$$AmountSpent = \beta_0 + \beta_1*AgeMid + \beta_2*AgeOld$$

# Quiz

-   With this Indicator variables coding scheme, $$AgeMid =
    \begin{cases}
    1, & \text{if Age=Middle } \\
    0, & \text{ohterwise}
    \end{cases},
     \quad AgeOld =
    \begin{cases}
    1, & \text{if Age=Old } \\
    0, & \text{ohterwise}
    \end{cases}
    $$ Can a record in the dirmkt dataframe have this value (AgeMid = 0,
    AgeOld = 0)?
    
    

-   Can a record in the dirmkt dataframe have this value (AgeMid = 1,
    AgeOld = 1)?

# A Linear Model With Dummy Variables

```{r}
model_1<-lm(AmountSpent~AgeMid+AgeOld,data=dirmkt)
summary(model_1)
```

# Regression with Dummy Variable

-   $AmountSpent = \beta_0 + \beta_1*AgeMid + \beta_2*AgeOld$ Which age
    group's Average AmountSpent is $\$55.862$? Young, Middle, or Old?

    -   Correct Answer: With AgeMid = $0$ and AgeOld = $0$, $\beta_0$
        captures the average AmountSpent of customers who are Young
        (base case)

-   What is the Average AmountSpent for someone who is middle-aged?

    -   This individual has AgeMid = $1$ and AgeOld = $0$, so
        $\beta_0 + \beta_1$ captures the average AmountSpent for folks
        who are middle-aged

    -   $\beta_0 + \beta_1 = \$55.862 + \$94.307 = \$150.169$

    -   So, $\$94.307$ is the increase in AmountSpent (on average) for
        middle-aged customers compared to someone who is young

-   What is the Average AmountSpent for someone who is old?

    -   This individual has AgeMid = $0$ and AgeOld = $1$, so
        $\beta_0 + \beta_1$ captures the average AmountSpent for folks
        who are old-aged

    -   $\beta_0 + \beta_1 = \$55.862 + \$87.350 = \$143.212$

    -   So, $\$87.350$ is the increase in AmountSpent (on average) for
        old customers compared to someone who is young

# Note

You can directly use a Factor Variable in regression in R instead of
creating & using Dummy variables

```{r}
lm(AmountSpent ~ Age, data=dirmkt)
```

-   What is the base case? What is the average AmountSpent for the base
    case? The Base Case is Old with Average AmountSpent = $\$143.213$

-   What is the Average AmountSpent of Young?
    $\$143.213 - \$87.350 = \$55.863$

-   What is the Average AmountSpent of Middle?
    $\$143.213 + \$6.956 = \$150.169$

-   All three groups have the same answers as our coding scheme where
    Young was the base case!!!

# Quiz

```{r}
model_2<-lm(AmountSpent~Salary+AgeMid+AgeOld,data=dirmkt)
summary(model_2)
```

What does this result mean?

-   A. Middle-aged customers spend the most
-   B. Old customers spend the least
-   C. Old customers spend more that young customers
-   D. At the same salary level, old customers spend more than young
    customers What is the current answer? 
    
    **D**. At the same salary
    level, old customers spend more than young customers

![](dummy.png){width="60%"}

# Interaction Term

-   Is spending rate higher for customers how live far away?

-   To answer this question we need to construct a new variable
    SalaryFar

-   SalaryFar = Salary \* Far, is an Interaction Term

$$AmountSpent = \beta_0 + \beta_1*Salary + \beta_2*Far + \beta_3*Salary*Far$$

```{r}
dirmkt$Far<-ifelse(dirmkt$Location=='Far',1,0)
dirmkt$SalaryFar<-(dirmkt$Salary)*(dirmkt$Far)
model_3<-lm(AmountSpent~Salary+Far+SalaryFar,data=dirmkt)
summary(model_3)
```

-   How would you interpret $\beta_3$ the coefficient of SalaryFar?

-   $\beta_3$ is the amount to add to $\beta_1$ to get the slope for
    individuals who live far away

![](interact.png){width="70%"}

# Quiz

-   If the salary of a customer who lives far away increases by
    $\$10,000$, what is the predicted increase in AmountSpent for that
    customer?

    - For this customer, Far = 1, hence the relevant slope is
    $\beta_1 + \beta_3 = 0.002 + 0.001 = 0.003$

    - Hence, the increase in AmountSpent (on average) for this
        individual = $\$.003*10000 =\$30$
