---
title: "Untitled"
output: html_document
date: "2024-04-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(leaps)
library(MASS)
library(ggplot2)
library(readr)
library(reshape2)
library(boot)
library(class)
library(klaR)
library(nnet)
library(rpart)
library(rpart.plot)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
data <- read.csv("obesity.csv")
data$BMI <- round(data$Weight / (data$Height^2), 2)
head(data,10)
str(data)
unique(data$NObeyesdad)
overweight_data <- data[data$NObeyesdad == "Overweight_Level_I", ]

# Printing the number of rows in the filtered data
print(nrow(overweight_data))


pie_colors <- c("lightblue", "lightgreen", "orange", "brown", "lavender", "lightyellow", "lightpink")
target_count <- table(data$NObeyesdad)
target_count <- as.data.frame(target_count)
colnames(target_count) <- c("NObeyesdad", "Count")


target_count$Percentage <- target_count$Count / sum(target_count$Count) * 100
# Create a pie chart with ggplot2
ggplot(target_count, aes(x = "", y = Count, fill = NObeyesdad)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  scale_fill_manual(values = pie_colors) +
  labs(title = "Distribution of Obesity Levels") +
  theme_void() +
  theme(legend.position = "right") +
  guides(fill = guide_legend(title = "Obesity Levels")) +
  geom_text(
    aes(label = sprintf("%.1f%%", Percentage)),
    position = position_stack(vjust = 0.5),    
    size = 4                                   
  )

# Create a bar plot for obesity types
g <- ggplot(data, aes(x=NObeyesdad))
g + geom_bar(aes(fill=NObeyesdad), width = 0.5) + 
  theme(axis.text.x = element_text(angle=65, vjust=0.6)) +
  labs(title="Histogram on Categorical Variable", 
       subtitle="Distribution of Different Obesity Types",
       x = "Obesity Type", y = "Count")


theme_set(theme_classic())

# Subset for specific types of obesity
obesity_type <- data[data$NObeyesdad %in% c("Obesity_Type_I", "Obesity_Type_II", "Obesity_Type_III"), ]
head(obesity_type)

# Subset for specific levels of overweight
overweight_level <- data[data$NObeyesdad %in% c("Overweight_Level_I", "Overweight_Level_II"), ]
head(overweight_level)
others <- data[!data$NObeyesdad %in% c("Obesity_Type_I", "Obesity_Type_II", "Obesity_Type_III", "Overweight_Level_I", "Overweight_Level_II"), ]
head(others)




theme_set(theme_bw())

# plot
g <- ggplot(data = data, aes(x=Age, y= NObeyesdad,fill=NObeyesdad))
g + geom_violin() + 
  labs(title="Age vs NObeyesdad",
       caption="Source: mpg",
       x="Age",
       y="NObeyesdad")
ggplot(data, aes(x=Age, fill=NObeyesdad)) +
  geom_density(alpha=0.4)+
  xlim(14,40)+labs(title='Density Plot for Age',x='Age',y='Density')+theme_minimal()

ggplot(others, aes(x = Age)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black") +
  facet_wrap(~NObeyesdad, scales = "free") +
  labs(title = "Age Distribution for Normal Weight and Insufficient Types")+
    theme(axis.text = element_text(size = 6))


ggplot(obesity_type, aes(x = Age)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black") +
  facet_wrap(~NObeyesdad, scales = "free") +
  labs(title = "Age Distribution for Different Obesity Types")+
    theme(axis.text = element_text(size = 6))

ggplot(overweight_level, aes(x = Age)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black") +
  facet_wrap(~NObeyesdad, scales = "free") +
  labs(title = "Age Distribution for Different Overweight Types")+
    theme(axis.text = element_text(size = 6))

g <- ggplot(data = data, aes(x=Weight, y= NObeyesdad,fill=NObeyesdad))
g + geom_violin() + 
  labs(title="Weight vs NObeyesdad",
       caption="Source: mpg",
       x="Weight",
       y="NObeyesdad")

ggplot(data, aes(x=Weight, fill=NObeyesdad)) +
  geom_density(alpha=0.4)+
  xlim(30,170)+labs(title='Density Plot for Weight',x='Weight',y='Density')+theme_minimal()

ggplot(others, aes(x = Weight)) +
  geom_histogram(binwidth = 1, fill = "lavender", color = "black") +
  facet_wrap(~NObeyesdad, scales = "free") +
  labs(title = "Weight Distribution for Normal Weight and Insufficient Types")+
    theme(axis.text = element_text(size = 6))



ggplot(obesity_type, aes(x = Weight)) +
  geom_histogram(binwidth = 1, fill = "lavender", color = "black") +
  facet_wrap(~NObeyesdad, scales = "free") +
  labs(title = "Weight Distribution for Different Obesity Types")+
    theme(axis.text = element_text(size = 6))

ggplot(overweight_level, aes(x = Weight)) +
  geom_histogram(binwidth = 1, fill = "lavender", color = "black") +
  facet_wrap(~NObeyesdad, scales = "free") +
  labs(title = "Weight Distribution for Different Overweight Types")+
    theme(axis.text = element_text(size = 6))

g <- ggplot(data = data, aes(x=Height, y= NObeyesdad,fill=NObeyesdad))
g + geom_violin() + 
  labs(title="Height vs NObeyesdad",
       caption="Source: mpg",
       x="Height",
       y="NObeyesdad")

ggplot(data, aes(x=Height, fill=NObeyesdad)) +
  geom_density(alpha=0.4)+
  xlim(1.4,2.2)+labs(title='Density Plot for Height',x='Height',y='Density')+theme_minimal()

ggplot(others, aes(x = Height)) +
  geom_histogram(binwidth = 1, fill = "lightgray", color = "black") +
  facet_wrap(~NObeyesdad, scales = "free") +
  labs(title = "Height Distribution for Normal Weight and Insufficient Types")+
    theme(axis.text = element_text(size = 6))


ggplot(obesity_type, aes(x = Height)) +
  geom_histogram(binwidth = 1, fill = "lightgray", color = "black") +
  facet_wrap(~NObeyesdad, scales = "free") +
  labs(title = "Height Distribution for Different Obesity Types")+
    theme(axis.text = element_text(size = 6))

ggplot(overweight_level, aes(x = Height)) +
  geom_histogram(binwidth = 1, fill = "lightgray", color = "black") +
  facet_wrap(~NObeyesdad, scales = "free") +
  labs(title = "Age Distribution for Different Overweight Types")+
    theme(axis.text = element_text(size = 6))

ggplot(data, aes(x=BMI, fill=NObeyesdad)) +
  geom_density(alpha=0.4)+
  xlim(-0,60)+labs(title='Density Plot for BMI',x='BMI',y='Density')+theme_minimal()

g <- ggplot(data, aes(x = NObeyesdad))
g + geom_bar(aes(fill = Gender), width = 0.5, position = "dodge") + 
  theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
  labs(title = "Distribution of Different Obesity Types by Gender",
       x = "Obesity Type", y = "Count")

g <- ggplot(data, aes(x = NObeyesdad))
g + geom_bar(aes(fill = FAVC), width = 0.5, position = "dodge") + 
  theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
  labs(title ="Distribution of Different Obesity Types by FAVC",
       x = "Obesity Type", y = "Count")

g <- ggplot(data, aes(x = NObeyesdad))
g + geom_bar(aes(fill = CALC), width = 0.5, position = "dodge") + 
  theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
  labs(title = "Distribution of Different Obesity Types by CALC",
       x = "Obesity Type", y = "Count")

g <- ggplot(data, aes(x = NObeyesdad))
g + geom_bar(aes(fill = SCC), width = 0.5, position = "dodge") + 
  theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
  labs(title = "Distribution of Different Obesity Types by SCC",
       x = "Obesity Type", y = "Count")
g <- ggplot(data, aes(x = NObeyesdad))
g + geom_bar(aes(fill = SMOKE), width = 0.5, position = "dodge") + 
  theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
  labs(title = "Distribution of Different Obesity Types by SMOKE",
       x = "Obesity Type", y = "Count")
g <- ggplot(data, aes(x = NObeyesdad))
g + geom_bar(aes(fill = CAEC), width = 0.5, position = "dodge") + 
  theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
  labs(title ="Distribution of Different Obesity Types by CAEC",
       x = "Obesity Type", y = "Count")
g <- ggplot(data, aes(x = NObeyesdad))
g + geom_bar(aes(fill = MTRANS), width = 0.5, position = "dodge") + 
  theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
  labs(title = "Distribution of Different Obesity Types by MTRANS",
       x = "Obesity Type", y = "Count")

ggplot(data, aes(x = FCVC, y =NObeyesdad )) +
  geom_point() + 
  labs(title = "Scatterplot of Obesity Levels vs. FCVC",
       x = "Frequency of Vegetables Taken", 
       y = "Obesity Levels") +
  theme_minimal()

ggplot(data, aes(x = CH2O, y =NObeyesdad )) +
  geom_point() + 
  labs(title = "Scatterplot of Obesity Levels vs. FCVC",
       x = "Frequency of Water Consumed", 
       y = "Obesity Levels") +
  theme_minimal()

ggplot(data, aes(x = FAF, y =NObeyesdad )) +
  geom_point() + 
  labs(title = "Scatterplot of Obesity Levels vs. FCVC",
       x = "Frequency of Physical Activity Done", 
       y = "Obesity Levels") +
  theme_minimal()

ggplot(data, aes(x = TUE, y =NObeyesdad )) +
  geom_point() + 
  labs(title = "Scatterplot of Obesity Levels vs. FCVC",
       x = "Frequency of Usage of Technological Devices", 
       y = "Obesity Levels") +
  theme_minimal()






# Convert character variables to factors
data$Gender <- factor(data$Gender, levels = unique(data$Gender))
data$CALC <- factor(data$CALC, levels = unique(data$CALC))
data$FAVC <- factor(data$FAVC, levels = unique(data$FAVC))
data$SCC <- factor(data$SCC, levels = unique(data$SCC))
data$SMOKE <- factor(data$SMOKE, levels = unique(data$SMOKE))
data$family_history_with_overweight <- factor(data$family_history_with_overweight, levels = unique(data$family_history_with_overweight))
data$CAEC <- factor(data$CAEC, levels = unique(data$CAEC))
data$MTRANS <- factor(data$MTRANS, levels = unique(data$MTRANS))
data$NObeyesdad <- factor(data$NObeyesdad, levels = unique(data$NObeyesdad))

# Check the structure of the data frame
str(data)

numeric_data <- data[sapply(data, is.numeric)]

correlation_matrix <- cor(numeric_data, use = "pairwise.complete.obs")  # Handles missing data

# Print the correlation matrix
print(correlation_matrix)



# Melt the correlation matrix to make it suitable for ggplot2
melted_corr <- melt(correlation_matrix)

# Create a heatmap of the correlation matrix
ggplot(melted_corr, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile(color = "white") +  # Adds white borders to separate the tiles
  geom_text(aes(label = sprintf("%.2f", value)), size = 3, color = "black") +  # Adds correlation coefficients as labels
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0, 
                       limits = c(-1, 1), space = "Lab", 
                       name = "Correlation") +  # Sets the color gradient
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
    axis.text.y = element_text(angle = 0, vjust = 0.5),
    axis.title = element_blank(),  # Removes axis titles
    legend.position = "bottom"
  ) +
  labs(fill = 'Correlation Coefficient')  # Legend label




```

## Including Plots

You can also embed plots, for example:

```{r}
library(e1071)
library(gmodels)
fwd<-regsubsets(NObeyesdad~.,data=data,nvmax=16, method='forward')
summary(fwd)
bwd<-regsubsets(NObeyesdad~.,data=data,nvmax=16, method='backward')
summary(bwd)

set.seed(100515)
index<- sample(2,nrow(data),prob = c(0.8,0.2),replace=TRUE)
train_data=data[index==1,]
test_data<-data[index==2,]
print(dim(train_data))
print(dim(test_data)) 
train_data <- na.omit(train_data)  
test_data <- na.omit(test_data) 
Model1 <- multinom(NObeyesdad ~., data = train_data)
summary(Model1)
test_predictions <- predict(Model1, newdata = test_data)

test_actual_classes <- test_data$NObeyesdad
test_accuracy <- mean(test_predictions == test_actual_classes)
print(paste("Testing Accuracy of the multinomial logistic regression model:", test_accuracy))


naive_model <- naiveBayes(NObeyesdad ~., data = train_data)
summary(naive_model)
predictions <- predict(naive_model, test_data)

# Calculate accuracy
actual <- test_data$NObeyesdad  # The actual labels
correct <- sum(predictions == actual)  # Count correct predictions
accuracy <- correct / length(actual)  # Calculate accuracy

# Print the accuracy
print(paste("Accuracy of the Naive Bayes model:", accuracy))
lda_model <- lda(NObeyesdad~., train_data)
summary(lda_model)
predictions <- predict(lda_model, newdata = test_data)
predicted_labels <- predictions$class
actual_labels <- test_data$NObeyesdad

accuracy <- sum(predicted_labels == actual_labels) / length(actual_labels)

# Print the accuracy
print(paste("Accuracy of the LDA model:", accuracy))
library(randomForest)
actual <- test_data$NObeyesdad  # The actual labels
correct <- sum(predictions == actual)  # Count correct predictions
accuracy <- correct / length(actual)  # Calculate accuracy


# Impute missing values with mean
 


# Fit Random Forest model on imputed data
rf_model_imputed <- randomForest(NObeyesdad ~ ., data = train_data)

# Predict using Random Forest model on test data
rf_pred_imputed <- predict(rf_model_imputed, newdata = test_data)

# Evaluate Random Forest model on imputed data
rf_acc_imputed <- mean(rf_pred_imputed == test_data$NObeyesdad)
print(paste("Random Forest Accuracy (with imputed data):", rf_acc_imputed))


svm_model <- svm(NObeyesdad ~ ., data = train_data)

svm_pred <- predict(svm_model, newdata = test_data)

svm_acc <- mean(svm_pred == test_data$NObeyesdad)
print(paste("SVM Accuracy:", svm_acc))

# Fit the decision tree model using rpart
tree_model <- rpart(NObeyesdad ~ ., data = train_data, method = "class")

# Plot the decision tree
rpart.plot(tree_model, type = 4, extra = 101, fallen.leaves = TRUE)
tree_predictions <- predict(tree_model, newdata = test_data, type = "class")
tree_actual_classes <- test_data$NObeyesdad

# Calculate accuracy: proportion of correct predictions
tree_accuracy <- mean(tree_predictions == tree_actual_classes)

# Print the testing accuracy
print(paste("Testing Accuracy of the decision tree model:", tree_accuracy))
rpart.plot(tree_model, type = 4, extra = 101, fallen.leaves = TRUE)



```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
